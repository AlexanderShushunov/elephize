## Общие принципы построения библиотеки

#### 1. Typescript как основа

Вся библиотека построена как обвязка для компилятора typescript (tsc). Из библиотеки интенсивно используются парсер
и тайпчекер, а также структуры данных, порождаемые вместе с AST. Это означает, что:
- Заменить typescript другим парсером не представляется возможным, поскольку проще написать библиотеку заново.
- Для справки относительно парсера, AST и типов можно использовать любые источники, относящиеся к typescript, в том числе:
    - https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API
    - https://ts-ast-viewer.com/ или https://astexplorer.net/ для изучения AST
- Входные файлы должны быть правильными ts(x)-файлами, в ином случае не будет гарантий корректной транспиляции.

#### 2. Принцип ортогональности синтаксических конструкций

Архитектура построения компиляторов в целом и использование AST в частности позволяет использовать относительно независимые
обработчики различных синтаксических конструкций. В терминологии библиотеки elephize такие обработчики называются
**рендерерами** (renderer). Каждый рендерер (в идеальном мире) отвечает за свою и только за свою синтаксическую 
конструкцию. В реальном мире независимости рендереров удается достичь не всегда - часто смысл синтаксических конструкций
зависит от контекста. Тем не менее к такой независимости следует всячески стремиться в процессе разработки.

Отдельную категорию в составе elephize составляют рендереры стандартной библиотеки (stdlib renderers), которые 
отвечают за преобразование отдельных библиотечных вызовов (например, `.toString()` или `Array.prototype.map`).

#### 3. Дополнительные слои и подсистемы

Рендереры в процессе работы не только генерируют код, но и общаются с более высокоуровневыми слоями библиотеки, 
в частности:
- Слой поддержки модулей, отвечающий за:
    - Поддержку модульности в целом на основе инструкций import-export
    - Поддержку react-компонентов, enum-модулей и внешних модулей
    - Разрешение путей и раскладывание файлов по папкам и неймспейсам
- Слой специфической поддержки react, в частности - поддержки хуков и логики, позволяющей отличить компонент от обычной функции.
- Слой вывода типов, необходимый для:
    - Корректной генерации операторов и вызовов в случае неоднозначности (например, разница в генерации при обработке
      `.slice()` от строки и от массива)
    - Генерации типизированных phpdoc-комментариев
- Слой удаления неиспользуемого кода, необходимый для корректной очистки серверного кода после удаления из него клиентских
  обработчиков (например, onclick).
  